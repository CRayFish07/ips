<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			.mui-content>.mui-table-view:first-child {
				margin-top: 2px;
			}
		</style>
	</head>

	<body>
		<div class="mui-content">
			<ul class="mui-table-view menu" style="margin: 20px 0">
				<li class="mui-table-view-cell mui-media">
					<a href="person-center.html" class="mui-navigate-right">
						<img class="mui-media-object mui-pull-left" src="../img/usr_unlogin.jpg">
						<div class="mui-media-body">
							<span>昵称</span>
							<p class='mui-ellipsis' style="width: 90%;">个性签名个性签名个性签名个性签名个性签名个性签名</p>
						</div>
					</a>
				</li>
			</ul>
			<ul class="mui-table-view menu">
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="feedback.html">
						意见反馈
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="#share">
						分享给好友
					</a>
				</li>
			</ul>
			<ul class="mui-table-view menu" style="margin-top: 25px;">
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="about.html">
						关于我们
					</a>
				</li>
			</ul>
			<ul class="mui-table-view" style="margin-top: 30px;">
				<li class="mui-table-view-cell">
					<a id="logoff" style="text-align: center;color: #FF3B30;">
						退出登录
					</a>
				</li>
			</ul>
		</div>
		<div id="share" class="mui-popover mui-popover-action mui-popover-bottom">
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a href="#">分享到QQ空间</a>
				</li>
				<li class="mui-table-view-cell">
					<a href="#">分享到微博</a>
				</li>
				<li class="mui-table-view-cell">
					<a href="#">分享到朋友圈</a>
				</li>
			</ul>
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a href="#picture"><b>取消</b></a>
				</li>
			</ul>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/app.js"></script>
		<script type="text/javascript">
			mui.init();
			 //退出登录
			document.querySelector("#logoff").addEventListener('tap', function() {
				plus.nativeUI.showWaiting("正在注销");
				plus.storage.clear();
				plus.nativeUI.closeWaiting();
				mui.toast("注销成功");
			});
			mui("ul").on('tap', 'a', function() {
				var title = null;
				var href = this.href;
				var innerText = this.innerText;
				if (!~innerText.indexOf("退出")) {
					if (!~innerText.indexOf("分享")) {
						if (~href.indexOf("person")) {
							title = "个人中心";
						} else {
							title = innerText;
						}
						if (~innerText.indexOf("意见")) {
							mui.openWindow({
								url: href,
								waiting: {
									autoShow: true
								}
							});
						} else {
							template = plus.webview.getWebviewById("default-main");
							//获得共用子webview
							subWebview = template.children()[0];
							//通知模板修改标题，并显示隐藏右上角图标；
							mui.fire(template, 'updateHeader', {
								title: title
							});
							if (subWebview.getURL() != href) {
								subWebview.loadURL(href);
							} else {
								subWebview.show();
							}
							template.show('slide-in-right', 150);
						}
					}
				}
			});
			mui('body').on('shown', '.mui-popover', function(e) {
				//console.log('shown', e.detail.id);//detail为当前popover元素
			});
			mui('body').on('hidden', '.mui-popover', function(e) {
				//console.log('hidden', e.detail.id);//detail为当前popover元素
			});
			mui('body').on('tap', '.mui-popover-action li>a', function() {
				var a = this,
					parent;
				//根据点击按钮，反推当前是哪个actionsheet
				for (parent = a.parentNode; parent != document.body; parent = parent.parentNode) {
					if (parent.classList.contains('mui-popover-action')) {
						shareAction('weixin', 'WXSceneTimeline');
						break;
					}
				}
				//关闭actionsheet
				mui('#' + parent.id).popover('toggle');
				mui.toast("\"" + a.innerText + "\"功能正在紧急修复");
			});
			
			var shares = null;
			var sharecontent = '我爱你',
				sharehref = 'http://img5.tvsou.com/forenotice_images/20140804/2014-08-04-04-34-05.jpg',
				sharetitle = '我正在测试微信分享功能',
				sharepic = 'http://img5.tvsou.com/forenotice_images/20140804/2014-08-04-04-34-05.jpg';
			mui.plusReady(function() {
				plus.share.getServices(function(s) {
					shares = {};
					for (var i in s) {
						var t = s[i];
						shares[t.id] = t;
					}
				}, function(e) {
					mui.toast("获取分享服务列表失败：" + e.message);
				});
			});

			function shareMessage(id, s, ex) {
				if (id == 'weixin') {
					var msg = {
						title: sharetitle,
						href: sharehref,
						extra: {
							scene: ex
						}
					};
				} else {
					var msg = {
						content: sharecontent,
						extra: {
							scene: ex
						}
					};
				}
				s.send(msg, function() {
					mui.toast('分享成功');
				}, function(e) {
					mui.toast('分享失败，错误信息，' + e.message)
				});
			}

			function shareAction(id, ex) {
				var s = null;
				if (!id || !(s = shares[id])) {
					mui.toast("无效的分享服务！");
					return;
				}
				if (s.authenticated) {
					shareMessage(id, s, ex);
				} else {
					mui.toast("未授权");
					s.authorize(function() {
						shareMessage(id, s, ex);
					}, function(e) {
						mui.toast("认证授权失败：" + e.code + " - " + e.message);
					});
				}
			}
		</script>
	</body>

</html>